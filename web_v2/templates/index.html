<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hospital Information Hub</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

    <div class="container">
        <!-- HEADER -->
        <div class="header-box">
            <h1>üè• Hospital Information Hub: SOPs and FAQs </h1>
            <p class="subtitle">Fast Cognitive Search System</p>
        </div>

        <!-- SEARCH FORM -->
        <form action="/" method="get" class="search-form">
            <!-- Reset Page ke 0 setiap kali search baru -->
            <input type="hidden" name="page" value="0"> 
            
            <input type="text" name="q" class="search-input" 
                   placeholder="Cari kendala (cth: gimana sih cara ngedit obat di emr ed pharmacy?)..." 
                   value="{{ query }}" autofocus>
            
            <select name="tag" class="filter-select">
                {% for t in all_tags %}
                    <option value="{{ t }}" {% if t == current_tag %}selected{% endif %}>
                        {{ t }}
                    </option>
                {% endfor %}
            </select>

            <button type="submit" class="search-btn">Cari</button>
            
            <!-- Tombol Reset (Balik ke Home) -->
            {% if query %}
            <a href="/" class="reset-btn" title="Hapus pencarian">‚ùå</a>
            {% endif %}
        </form>

        <!-- INFO STATUS -->
        {% if is_search_mode %}
            <p class="result-info">üîç Menampilkan <strong>Top {{ total_items }}</strong> hasil paling mendekati secara semantik untuk: "<em>{{ query }}</em>"</p>
        {% else %}
            <p class="result-info">üìÇ Menampilkan SOP dan FAQ Terbaru (Halaman {{ page + 1 }} dari {{ total_pages }})</p>
        {% endif %}

        <!-- RESULTS LIST -->
        <div class="results">
            {% if not results %}
                <div class="empty-state">
                    <h3>‚ùå Tidak ditemukan data</h3>
                    <p>Coba kalimat lain atau hubungi Tim IT.</p>
                </div>
            {% endif %}

            {% for item in results %}
                <details>
                    <summary>
                        <div class="summary-content">
                            <span class="badge" style="background-color: {{ item.badge_color }}">
                                {{ item.tag }}
                            </span>
                            <span class="title-text">{{ item.judul }}</span>
                        </div>
                        
                        <!-- Hanya tampilkan badge score jika SEARCH MODE -->
                        {% if item.score %}
                        <span class="score-badge {{ item.score_class }}">
                            {{ item.score }}% Relevan
                        </span>
                        {% endif %}
                    </summary>

                    <div class="faq-content">
                        {{ item.html_content | safe }}
                        
                        {% if item.sumber_url and item.sumber_url|length > 3 %}
                            <br>
                            <a href="{{ item.sumber_url }}" target="_blank" class="source-link">
                                üîó Buka Sumber Referensi
                            </a>
                        {% endif %}
                    </div>
                </details>
            {% endfor %}
        </div>

        <!-- PAGINATION (Hanya muncul jika BUKAN mode search dan halaman > 1) -->
        {% if not is_search_mode and total_pages > 1 %}
        <div class="pagination">
            {% if page > 0 %}
                <a href="/?page={{ page - 1 }}&tag={{ current_tag }}&q=" class="page-btn">‚¨ÖÔ∏è Sebelumnya</a>
            {% else %}
                <span class="page-btn disabled">‚¨ÖÔ∏è Sebelumnya</span>
            {% endif %}

            <span class="page-info">{{ page + 1 }} / {{ total_pages }}</span>

            {% if page < total_pages - 1 %}
                <a href="/?page={{ page + 1 }}&tag={{ current_tag }}&q=" class="page-btn">Berikutnya ‚û°Ô∏è</a>
            {% else %}
                <span class="page-btn disabled">Berikutnya ‚û°Ô∏è</span>
            {% endif %}
        </div>
        {% endif %}
        
    </div>

</body>
</html>